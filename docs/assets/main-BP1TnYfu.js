import"./site-nav-k-8yBipB.js";const L=location.hostname.endsWith("github.io")?"https://jlzoo.onrender.com/api":"http://localhost:3000/api",x=new Set,w=new Map,C=new Map;function F(d,n,e){const t=e?.trim()||d;x.add(t),n&&w.set(t,n),e?.trim()&&e.trim()!==d&&C.set(d,e.trim())}function P(d){return x.has(d)?!0:C.has(d)}function N(d){return w.get(d)}function z(d){return C.get(d)}function $(d){return C.get(d)||d}function R(d,n){const e=document.querySelector(".adoption-modal");e&&e.remove();const t=document.createElement("div");t.className="adoption-modal",t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true"),t.style.position="fixed",t.style.zIndex=1e3,t.style.left=0,t.style.top=0,t.style.width="100vw",t.style.height="100vh",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.backgroundColor="rgba(0,0,0,0.45)";const a=document.createElement("div");a.style.background="#101820",a.style.padding="2rem",a.style.borderRadius="12px",a.style.boxShadow="0 8px 24px rgba(0,0,0,0.5)",a.style.color="#f0f4ff",a.style.fontFamily="system-ui, sans-serif",a.style.maxWidth="400px",a.style.width="90%",a.tabIndex=0;const o=document.createElement("h2");o.textContent=`Adopt ${d}`,o.style.marginTop="0",o.style.marginBottom="1rem",o.style.fontSize="1.25rem";const r=document.createElement("p");r.textContent="Give your adopted animal a custom name (optional):",r.style.marginTop="0",r.style.marginBottom="0.5em",r.style.color="#f0f4ff";const s=document.createElement("input");s.type="text",s.placeholder=d,s.value=d,s.setAttribute("aria-label","Custom name for adopted animal"),s.setAttribute("maxlength","40"),s.style.width="100%",s.style.padding="8px 10px",s.style.marginBottom="1em",s.style.border="1px solid #1a2440",s.style.borderRadius="10px",s.style.fontSize="1em",s.style.background="#0b1223",s.style.color="#f0f4ff",s.style.boxSizing="border-box";const l=document.createElement("p");l.textContent="Please enter your phone number to finalize your adoption:",l.style.marginBottom="0.5em",l.style.color="#f0f4ff";const i=document.createElement("input");i.type="tel",i.required=!0,i.placeholder="e.g. 555-555-5555",i.setAttribute("aria-label","Phone number"),i.style.width="100%",i.style.padding="8px 10px",i.style.marginBottom="0.5em",i.style.border="1px solid #1a2440",i.style.borderRadius="10px",i.style.fontSize="1em",i.style.background="#0b1223",i.style.color="#f0f4ff",i.style.boxSizing="border-box";const c=document.createElement("div");c.style.color="#ffb4a3",c.style.fontSize="0.9em",c.style.margin="0.5em 0",c.style.minHeight="1.2em";const u=document.createElement("form");u.style.margin=0,u.method="post",u.action="javascript:void(0)",u.noValidate=!0;const f=document.createElement("div");f.style.marginTop="1.2em",f.style.display="flex",f.style.gap="1em",f.style.justifyContent="flex-end";const p=document.createElement("button");p.type="button",p.textContent="Cancel",p.style.padding="8px 14px",p.style.border="1px solid #5aa2ff",p.style.borderRadius="8px",p.style.background="transparent",p.style.color="#f0f4ff",p.style.cursor="pointer",p.style.fontSize="1em",p.style.fontFamily="inherit";const h=document.createElement("button");h.textContent="Adopt",h.type="submit",h.style.fontWeight="bold",h.style.padding="8px 14px",h.style.border="none",h.style.borderRadius="8px",h.style.background="#5aa2ff",h.style.color="#000",h.style.cursor="pointer",h.style.fontSize="1em",h.style.fontFamily="inherit",f.append(p,h),u.append(r,s,l,i,c,f),a.append(o,u),t.appendChild(a),document.body.appendChild(t),s.focus(),s.select(),s.addEventListener("input",()=>{c.textContent&&(c.textContent="")}),i.addEventListener("input",()=>{c.textContent&&(c.textContent="")});const y=()=>{const m=s.value.trim(),v=k(m);if(!v.valid){c.textContent=v.message,s.focus();return}const A=i.value.trim(),_=D(A);if(!_.valid){c.textContent=_.message,i.focus();return}const S=m||d;F(d,A,m),n&&n(d,A,S),E()};u.addEventListener("submit",m=>{m.preventDefault(),m.stopPropagation(),y()}),h.onclick=m=>{m.preventDefault(),m.stopPropagation(),y()},p.onclick=E,t.addEventListener("click",m=>{m.target===t&&E()});const g=m=>{m.key==="Enter"&&(m.preventDefault(),y())};s.addEventListener("keydown",g),i.addEventListener("keydown",g);const b=m=>{m.addEventListener("focus",()=>{m.style.outline="none",m.style.borderColor="#5aa2ff"}),m.addEventListener("blur",()=>{m.style.borderColor="#1a2440"})};b(s),b(i);function E(){t.remove()}}function k(d){const n=d.trim();if(n==="")return{valid:!0,message:""};if(n.length<2)return{valid:!1,message:"Name must be at least 2 characters long."};if(n.length>40)return{valid:!1,message:"Name must be 40 characters or less."};if(!/^(?:[A-Za-z]{2,}|[A-Za-z][\s\-']?[A-Za-z])(?:[\s\-'][A-Za-z]+)*$/.test(n))return{valid:!1,message:"Name must contain only letters, spaces, hyphens, and apostrophes."};if(!/[A-Za-z]/.test(n))return{valid:!1,message:"Name must contain at least one letter."};const t=n.replace(/[\s\-']/g,"").toLowerCase();return t.length>0&&/^([a-z])\1+$/.test(t)?{valid:!1,message:"Name cannot consist of only repeating letters."}:{valid:!0,message:""}}function D(d){const n=d.trim();if(!/^\s*(?:\+?1[.\-\s]?)?(?:\(?\d{3}\)?[.\-\s]?\d{3}[.\-\s]?\d{4})\s*$/.test(n))return{valid:!1,message:"Please enter a valid phone number (10 digits)."};let t=n.replace(/\D/g,"");if(t.length===11&&t.startsWith("1")&&(t=t.slice(1)),t.length!==10)return{valid:!1,message:"Phone number must have exactly 10 digits."};const a=t.slice(0,3),o=t.slice(3,6),r=t.slice(6);return a[0]<"2"||a[0]>"9"?{valid:!1,message:"Area code must start with digits 2-9."}:o[0]<"2"||o[0]>"9"?{valid:!1,message:"Phone number prefix must start with digits 2-9."}:o==="000"||r==="0000"?{valid:!1,message:"Please enter a realistic phone number, not all zeros."}:/^(\d)\1{9}$/.test(t)?{valid:!1,message:"Please enter a realistic phone number."}:a===o&&o===r?{valid:!1,message:"Please enter a realistic phone number."}:(l=>{let i=!0,c=!0;for(let u=1;u<l.length;u++)parseInt(l[u])!==parseInt(l[u-1])+1&&(i=!1),parseInt(l[u])!==parseInt(l[u-1])-1&&(c=!1);return i||c})(t)?{valid:!1,message:"Please enter a realistic phone number."}:{valid:!0,message:""}}class I extends HTMLElement{constructor(){super(),this.zooAnimals=[];const n=document.createElement("div");n.className="exhibit-wrapper";const e=this._createPanel("Browse by Animal");this.selectedAnimalDropdown=document.createElement("select"),this.selectedAnimalDropdown.setAttribute("aria-label","Animal Dropdown"),this.animalCardContainer=document.createElement("div"),this.animalCardContainer.className="card-container";const t=this._createRow(this.selectedAnimalDropdown);e.append(t,this.animalCardContainer);const a=this._createPanel("Adopted Animals");this.adoptedAnimalsList=document.createElement("ul"),this.adoptedAnimalsList.className="adopted-list",a.append(this.adoptedAnimalsList);const o=this._createPanel("Search the Zoo");this.searchQueryInput=document.createElement("input"),this.searchQueryInput.type="search",this.searchQueryInput.placeholder="Search by name or class...",this.searchResultsList=document.createElement("ul"),this.searchResultsList.className="results-list",o.append(this.searchQueryInput,this.searchResultsList);const r=this._createPanel("Add an Animal");this.addAnimalForm=document.createElement("form"),this.addAnimalForm.className="form-add",this.addAnimalForm.method="post",this.addAnimalForm.action="javascript:void(0)",this.formMessage=document.createElement("p"),this.formMessage.className="form-message";const s="^(?:[A-Za-z]{2,}|[A-Za-z][ \\-][A-Za-z])(?:[ \\-][A-Za-z]+)*$",l=this._field("Species *","species","input",{type:"text",required:"",minlength:"2",maxlength:"40",pattern:s,title:"Letters only (spaces or hyphens allowed, at least 2 letters)"}),i=this._field("Class *","class","input",{type:"text",required:"",minlength:"2",maxlength:"40",pattern:s,title:"Letters only (spaces or hyphens allowed, at least 2 letters)"}),c=this._field("Conservation Status *","conservationStatus","select",{required:""}),u=c.querySelector("select");["","Least Concern","Near Threatened","Vulnerable","Endangered","Critically Endangered"].forEach(m=>{const v=document.createElement("option");v.value=m,v.textContent=m||"— Select status —",u.appendChild(v)});const f=this._field("Habitat *","habitat","input",{type:"text",required:"",minlength:"2",maxlength:"60",pattern:s,title:"Letters only (spaces or hyphens allowed, at least 2 letters)"}),p=this._field("Image URL","img","input",{type:"url",placeholder:"https://…",pattern:"^https://.+",title:"Must start with https:// and end with .png, .jpg, .jpeg, or .gif"}),h=this._field("Description *","description","textarea",{rows:"3",placeholder:"Short description",required:"",minlength:"10",maxlength:"500"}),y=this._field("Fun Fact","more","input",{type:"text",placeholder:"Optional",maxlength:"120"}),g=this._createButton("Add to Zoo","primary");g.type="submit";const b=this._createButton("Reset","ghost");b.type="reset";const E=this._createRow([g,b]);this.addAnimalForm.append(l,i,c,f,p,h,y,E,this.formMessage),r.append(this.addAnimalForm),this._attachValidation(),n.append(e,a,o,r),this.append(n)}connectedCallback(){this._wireEvents(),this._loadAnimals(),this._renderAdoptedList()}_clearNode(n){for(;n.firstChild;)n.removeChild(n.firstChild)}_createPanel(n){const e=document.createElement("section");e.className="panel";const t=document.createElement("h2");return t.textContent=n,e.appendChild(t),e}_createRow(n){const e=document.createElement("div");e.className="row";const t=Array.isArray(n)?n:[n];for(const a of t)a&&e.appendChild(a);return e}_createButton(n,e){const t=document.createElement("button");return t.textContent=n,t.className="btn"+(e?" "+e:""),t}_createLabeledInput(n,e,t){const a=document.createElement("label");a.textContent=n;const o=document.createElement("input");return o.type=e,o.name=t,a.appendChild(o),a}_createLabeledSelect(n,e,t){const a=document.createElement("label");a.textContent=n;const o=document.createElement("select");return o.name=e,t.forEach(r=>{const s=document.createElement("option");s.value=r,s.textContent=r||"Select...",o.appendChild(s)}),a.appendChild(o),a}async _loadAnimals(){try{const n=await fetch(`${L}/animals`,{cache:"no-store"});if(!n.ok)throw new Error(`Fetch failed: ${n.status}`);const e=await n.json();console.log("Fetched data:",e),this.zooAnimals=Array.isArray(e.animals)?e.animals:e,this._populateDropdown()}catch(n){console.error("Animal load error:",n),this.animalCardContainer.textContent="Could not load animals."}}_populateDropdown(){this._clearNode(this.selectedAnimalDropdown);const n=document.createElement("option");n.value="",n.textContent="- Select an Animal -",this.selectedAnimalDropdown.appendChild(n),this.zooAnimals.forEach(e=>{const t=document.createElement("option");t.value=e.name,t.textContent=e.name,this.selectedAnimalDropdown.appendChild(t)})}_field(n,e,t="input",a={}){const o=document.createElement("div");o.className="field";const r=document.createElement("label");r.setAttribute("for",e),r.textContent=n;const s=document.createElement(t);s.name=e,s.id=e,Object.entries(a).forEach(([i,c])=>s.setAttribute(i,c));const l=document.createElement("div");return l.className="field-error",l.id=`${e}-error`,l.setAttribute("aria-live","polite"),s.setAttribute("aria-describedby",l.id),o.append(r,s,l),o}_getField(n){const e=this.addAnimalForm.querySelector(`[name="${n}"]`),t=e?.closest(".field"),a=t?.querySelector(".field-error");return{wrap:t,control:e,error:a}}_setError(n,e){const{wrap:t,control:a,error:o}=this._getField(n);t&&(e?(t.classList.add("is-invalid"),a?.setAttribute("aria-invalid","true"),o&&(o.textContent=e)):(t.classList.remove("is-invalid"),a?.removeAttribute("aria-invalid"),o&&(o.textContent="")))}_validateField(n){const{control:e}=this._getField(n);if(!e)return!0;const t=e.tagName.toLowerCase(),a=e.getAttribute("type")||"";(t==="input"&&(a==="text"||a==="url")||t==="textarea")&&(e.value=e.value.trim());const o=e.validity,r={species:"Species",class:"Class",conservationStatus:"Conservation Status",habitat:"Habitat",img:"Image URL",description:"Description",more:"Fun Fact"};let s="";if(o.valueMissing?s=`${r[e.name]||"This field"} is required.`:o.tooShort?s=`Please enter at least ${e.getAttribute("minlength")} characters.`:o.tooLong?s=`Please use at most ${e.getAttribute("maxlength")} characters.`:o.typeMismatch&&e.type==="url"?s="Please enter a valid URL (https://…).":o.patternMismatch&&(["species","class","habitat"].includes(e.name)?s=`${r[e.name]} must contain letters only (you may use spaces or hyphens) and at least 2 letters.`:s="Please match the requested format."),!s&&e.name==="conservationStatus"&&e.value===""&&(s="Please select a conservation status."),!s&&e.name==="img"&&e.value){const l=e.value.trim();if(!/^https:\/\//i.test(l))s="Image URL must start with https://";else{let i=l;try{i=new URL(l).pathname}catch{}/\.(png|jpe?g|gif)$/i.test(i)||(s="Please use a URL ending in .png, .jpg, .jpeg, or .gif")}}return this._setError(e.name,s),!s}_validateForm(){const n=["species","class","conservationStatus","habitat","img","description","more"];let e=null,t=!0;for(const a of n){const o=this._validateField(a);!o&&!e&&(e=this._getField(a).control),t=t&&o}return!t&&e&&e.focus(),t}_attachValidation(){this.addAnimalForm.querySelectorAll("input, select, textarea").forEach(e=>{e.addEventListener("blur",()=>this._validateField(e.name)),e.addEventListener("input",()=>{e.checkValidity()&&this._setError(e.name,"")}),e.tagName.toLowerCase()==="select"&&e.addEventListener("change",()=>this._validateField(e.name))})}_wireEvents(){this.selectedAnimalDropdown.addEventListener("change",async()=>{const n=this.zooAnimals.find(e=>e.name===this.selectedAnimalDropdown.value);n&&this._renderCard(n)}),this.searchQueryInput.addEventListener("input",async()=>{const n=(this.searchQueryInput.value||"").trim().toLowerCase();if(this._clearNode(this.searchResultsList),!n)return;const e=a=>String(a??"").toLowerCase(),t=this.zooAnimals.filter(a=>[a.name,a.type,a.class,a.species,a.habitat,a.conservationStatus].some(r=>e(r).includes(n)));if(t.length===0){const a=document.createElement("li");a.textContent="No matches",a.className="muted",this.searchResultsList.appendChild(a);return}for(const a of t){const o=document.createElement("li"),r=a?.name??"Unknown",s=a?.type??a?.class??a?.species??"";o.textContent=s?`${r} (${s})`:r,o.addEventListener("click",()=>this._renderCard(a)),this.searchResultsList.appendChild(o)}}),this.addAnimalForm.addEventListener("submit",async n=>{if(n.preventDefault(),n.stopPropagation(),!this._validateForm())return;const e=new FormData(this.addAnimalForm),t={name:e.get("species")?.trim(),type:e.get("class")?.trim(),conservationStatus:e.get("conservationStatus")?.trim(),habitat:e.get("habitat")?.trim(),description:e.get("description")?.trim()},a=e.get("img")?.trim();a?t.image=a:t.image="images/comingSoon.png";const o=e.get("more")?.trim();o&&(t.funFact=o);const r=["name","type","conservationStatus","habitat","description"];for(const s of r)if(!t[s]||t[s].trim()===""){this.formMessage.textContent=`Error: ${s} is required.`;return}try{console.log("Sending animal data:",t);const s=await fetch(`${L}/animals`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){const i=await s.text();throw console.error("Server error response:",i),new Error(`Create failed: ${s.status} - ${i}`)}let l=null;s.status===204?(await this._loadAnimals(),l=this.zooAnimals.find(i=>i.name===t.name&&i.type===t.type)||t):(l=await s.json(),this.zooAnimals.push(l),this._populateDropdown()),s.status!==204&&this._populateDropdown(),this.formMessage.textContent="Animal added!",this.addAnimalForm.reset(),["species","class","conservationStatus","habitat","img","description","more"].forEach(i=>this._setError(i,"")),setTimeout(()=>this.formMessage.textContent="",4e3)}catch(s){console.error(s),this.formMessage.textContent="Error: could not save animal."}})}_renderCard(n){this._clearNode(this.animalCardContainer);const e=document.createElement("div");e.className="animal-card";const t=document.createElement("img");t.src=n.image,t.alt=n.name;const a=$(n.name),o=z(n.name),r=P(n.name),s=document.createElement("h3");if(s.textContent=a,r){const y=document.createElement("span");y.textContent="✓ Adopted",y.style.cssText="display: inline-block; margin-left: 8px; padding: 4px 8px; background: #28a745; color: white; border-radius: 4px; font-size: 0.75rem; font-weight: 600;",s.appendChild(y)}let l=null;r&&o&&o!==n.name&&(l=document.createElement("p"),l.style.cssText="color: #6c757d; font-size: 0.9em; font-style: italic; margin-top: -4px; margin-bottom: 8px;",l.textContent=`Originally: ${n.name}`);const i=document.createElement("p");i.textContent=`Class: ${n.type}`;const c=document.createElement("p");c.textContent=`Status: ${n.conservationStatus}`;const u=document.createElement("p");u.textContent=`Habitat: ${n.habitat}`;const f=document.createElement("p");f.textContent=n.description||"";const p=this._createButton(r?"Already Adopted":"Adopt",r?"ghost":"primary");r?(p.disabled=!0,p.style.opacity="0.6",p.style.cursor="not-allowed"):p.addEventListener("click",()=>{R(n.name,(y,g,b)=>{this._renderCard(n),this._renderAdoptedList()})});const h=[t,s];l&&h.push(l),h.push(i,c,u,f,p),e.append(...h),this.animalCardContainer.appendChild(e)}_renderAdoptedList(){if(this._clearNode(this.adoptedAnimalsList),!x||x.size===0){const n=document.createElement("li");n.className="muted",n.textContent="No adopted animals yet.",this.adoptedAnimalsList.appendChild(n);return}for(const n of x){const e=document.createElement("li"),t=document.createElement("div");t.className="adopt-info";const a=document.createElement("span");a.textContent=n;const o=N(n),r=document.createElement("span");r.className="adopt-phone",r.textContent=o?`Phone: ${o}`:"",t.append(a),o&&t.append(r);const s=document.createElement("button");s.type="button",s.className="btn danger sm",s.textContent="Remove",s.setAttribute("aria-label",`Remove adoption for ${n}`),s.addEventListener("click",()=>{x.delete(n),w.delete(n),this._renderAdoptedList()}),e.append(t,s),this.adoptedAnimalsList.appendChild(e)}}}customElements.define("animal-exhibit",I);
