import"./site-nav-k-8yBipB.js";const L=location.hostname.endsWith("github.io")?"https://jlzoo.onrender.com/api":"http://localhost:3000/api",v=new Set,_=new Map,x=new Map;function A(c){return c&&c.charAt(0).toUpperCase()+c.slice(1).toLowerCase()}function N(c,t,e){let n;if(e?.trim()){const s=e.trim(),o=A(c);n=`${A(s)} the ${o}`,x.set(c,n)}else n=A(c);v.add(n),t&&_.set(n,t)}function P(c){if(x.has(c))return!0;const t=A(c);if(v.has(t))return!0;for(const e of v)if(e.endsWith(` the ${t}`))return!0;return!1}function $(c){return _.get(c)}function k(c){return x.get(c)||null}function S(c){if(x.has(c))return x.get(c);const t=A(c);if(v.has(t))return t;for(const e of v)if(e.endsWith(` the ${t}`))return e;return c}function R(c,t){const e=document.querySelector(".adoption-modal");e&&e.remove();const n=document.createElement("div");n.className="adoption-modal",n.setAttribute("role","dialog"),n.setAttribute("aria-modal","true"),n.style.position="fixed",n.style.zIndex=1e3,n.style.left=0,n.style.top=0,n.style.width="100vw",n.style.height="100vh",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.backgroundColor="rgba(0,0,0,0.45)";const s=document.createElement("div");s.style.background="#101820",s.style.padding="2rem",s.style.borderRadius="12px",s.style.boxShadow="0 8px 24px rgba(0,0,0,0.5)",s.style.color="#f0f4ff",s.style.fontFamily="system-ui, sans-serif",s.style.maxWidth="400px",s.style.width="90%",s.tabIndex=0;const o=document.createElement("h2");o.textContent=`Adopt ${c}`,o.style.marginTop="0",o.style.marginBottom="1rem",o.style.fontSize="1.25rem";const r=document.createElement("p");r.textContent="Give your adopted animal a custom name (optional):",r.style.marginTop="0",r.style.marginBottom="0.5em",r.style.color="#f0f4ff";const a=document.createElement("input");a.type="text",a.placeholder=c,a.value=c,a.setAttribute("aria-label","Custom name for adopted animal"),a.setAttribute("maxlength","40"),a.style.width="100%",a.style.padding="8px 10px",a.style.marginBottom="1em",a.style.border="1px solid #1a2440",a.style.borderRadius="10px",a.style.fontSize="1em",a.style.background="#0b1223",a.style.color="#f0f4ff",a.style.boxSizing="border-box";const l=document.createElement("p");l.textContent="Please enter your phone number to finalize your adoption:",l.style.marginBottom="0.5em",l.style.color="#f0f4ff";const i=document.createElement("input");i.type="tel",i.required=!0,i.placeholder="e.g. 555-555-5555",i.setAttribute("aria-label","Phone number"),i.style.width="100%",i.style.padding="8px 10px",i.style.marginBottom="0.5em",i.style.border="1px solid #1a2440",i.style.borderRadius="10px",i.style.fontSize="1em",i.style.background="#0b1223",i.style.color="#f0f4ff",i.style.boxSizing="border-box";const d=document.createElement("div");d.style.color="#ffb4a3",d.style.fontSize="0.9em",d.style.margin="0.5em 0",d.style.minHeight="1.2em";const u=document.createElement("form");u.style.margin=0,u.method="post",u.action="javascript:void(0)",u.noValidate=!0;const y=document.createElement("div");y.style.marginTop="1.2em",y.style.display="flex",y.style.gap="1em",y.style.justifyContent="flex-end";const h=document.createElement("button");h.type="button",h.textContent="Cancel",h.style.padding="8px 14px",h.style.border="1px solid #5aa2ff",h.style.borderRadius="8px",h.style.background="transparent",h.style.color="#f0f4ff",h.style.cursor="pointer",h.style.fontSize="1em",h.style.fontFamily="inherit";const p=document.createElement("button");p.textContent="Adopt",p.type="submit",p.style.fontWeight="bold",p.style.padding="8px 14px",p.style.border="none",p.style.borderRadius="8px",p.style.background="#5aa2ff",p.style.color="#000",p.style.cursor="pointer",p.style.fontSize="1em",p.style.fontFamily="inherit",y.append(h,p),u.append(r,a,l,i,d,y),s.append(o,u),n.appendChild(s),document.body.appendChild(n),a.focus(),a.select(),a.addEventListener("input",()=>{d.textContent&&(d.textContent="")}),i.addEventListener("input",()=>{d.textContent&&(d.textContent="")});const g=()=>{const m=a.value.trim(),E=D(m);if(!E.valid){d.textContent=E.message,a.focus();return}const w=i.value.trim(),F=I(w);if(!F.valid){d.textContent=F.message,i.focus();return}N(c,w,m);const z=S(c);t&&t(c,w,z),C()};u.addEventListener("submit",m=>{m.preventDefault(),m.stopPropagation(),g()}),p.onclick=m=>{m.preventDefault(),m.stopPropagation(),g()},h.onclick=C,n.addEventListener("click",m=>{m.target===n&&C()});const b=m=>{m.key==="Enter"&&(m.preventDefault(),g())};a.addEventListener("keydown",b),i.addEventListener("keydown",b);const f=m=>{m.addEventListener("focus",()=>{m.style.outline="none",m.style.borderColor="#5aa2ff"}),m.addEventListener("blur",()=>{m.style.borderColor="#1a2440"})};f(a),f(i);function C(){n.remove()}}function D(c){const t=c.trim();if(t==="")return{valid:!0,message:""};if(t.length<2)return{valid:!1,message:"Name must be at least 2 characters long."};if(t.length>40)return{valid:!1,message:"Name must be 40 characters or less."};if(!/^(?:[A-Za-z]{2,}|[A-Za-z][\s\-']?[A-Za-z])(?:[\s\-'][A-Za-z]+)*$/.test(t))return{valid:!1,message:"Name must contain only letters, spaces, hyphens, and apostrophes."};if(!/[A-Za-z]/.test(t))return{valid:!1,message:"Name must contain at least one letter."};const n=t.replace(/[\s\-']/g,"").toLowerCase();return n.length>0&&/^([a-z])\1+$/.test(n)?{valid:!1,message:"Name cannot consist of only repeating letters."}:{valid:!0,message:""}}function I(c){const t=c.trim();if(!/^\s*(?:\+?1[.\-\s]?)?(?:\(?\d{3}\)?[.\-\s]?\d{3}[.\-\s]?\d{4})\s*$/.test(t))return{valid:!1,message:"Please enter a valid phone number (10 digits)."};let n=t.replace(/\D/g,"");if(n.length===11&&n.startsWith("1")&&(n=n.slice(1)),n.length!==10)return{valid:!1,message:"Phone number must have exactly 10 digits."};const s=n.slice(0,3),o=n.slice(3,6),r=n.slice(6);return s[0]<"2"||s[0]>"9"?{valid:!1,message:"Area code must start with digits 2-9."}:o[0]<"2"||o[0]>"9"?{valid:!1,message:"Phone number prefix must start with digits 2-9."}:o==="000"||r==="0000"?{valid:!1,message:"Please enter a realistic phone number, not all zeros."}:/^(\d)\1{9}$/.test(n)?{valid:!1,message:"Please enter a realistic phone number."}:s===o&&o===r?{valid:!1,message:"Please enter a realistic phone number."}:(l=>{let i=!0,d=!0;for(let u=1;u<l.length;u++)parseInt(l[u])!==parseInt(l[u-1])+1&&(i=!1),parseInt(l[u])!==parseInt(l[u-1])-1&&(d=!1);return i||d})(n)?{valid:!1,message:"Please enter a realistic phone number."}:{valid:!0,message:""}}class B extends HTMLElement{constructor(){super(),this.zooAnimals=[];const t=document.createElement("div");t.className="exhibit-wrapper";const e=this._createPanel("Browse by Animal");this.selectedAnimalDropdown=document.createElement("select"),this.selectedAnimalDropdown.setAttribute("aria-label","Animal Dropdown"),this.animalCardContainer=document.createElement("div"),this.animalCardContainer.className="card-container";const n=this._createRow(this.selectedAnimalDropdown);e.append(n,this.animalCardContainer);const s=this._createPanel("Adopted Animals");this.adoptedAnimalsList=document.createElement("ul"),this.adoptedAnimalsList.className="adopted-list",s.append(this.adoptedAnimalsList);const o=this._createPanel("Search the Zoo");this.searchQueryInput=document.createElement("input"),this.searchQueryInput.type="search",this.searchQueryInput.placeholder="Search by name or class...",this.searchResultsList=document.createElement("ul"),this.searchResultsList.className="results-list",o.append(this.searchQueryInput,this.searchResultsList);const r=this._createPanel("Add an Animal");this.addAnimalForm=document.createElement("form"),this.addAnimalForm.className="form-add",this.addAnimalForm.method="post",this.addAnimalForm.action="javascript:void(0)",this.formMessage=document.createElement("p"),this.formMessage.className="form-message";const a="^(?:[A-Za-z]{2,}|[A-Za-z][ \\-][A-Za-z])(?:[ \\-][A-Za-z]+)*$",l=this._field("Species *","species","input",{type:"text",required:"",minlength:"2",maxlength:"40",pattern:a,title:"Letters only (spaces or hyphens allowed, at least 2 letters)"}),i=this._field("Class *","class","input",{type:"text",required:"",minlength:"2",maxlength:"40",pattern:a,title:"Letters only (spaces or hyphens allowed, at least 2 letters)"}),d=this._field("Conservation Status *","conservationStatus","select",{required:""}),u=d.querySelector("select");["","Least Concern","Near Threatened","Vulnerable","Endangered","Critically Endangered"].forEach(m=>{const E=document.createElement("option");E.value=m,E.textContent=m||"— Select status —",u.appendChild(E)});const y=this._field("Habitat *","habitat","input",{type:"text",required:"",minlength:"2",maxlength:"60",pattern:a,title:"Letters only (spaces or hyphens allowed, at least 2 letters)"}),h=this._field("Image URL","img","input",{type:"url",placeholder:"https://…",pattern:"^https://.+",title:"Must start with https:// and end with .png, .jpg, .jpeg, or .gif"}),p=this._field("Description *","description","textarea",{rows:"3",placeholder:"Short description",required:"",minlength:"10",maxlength:"500"}),g=this._field("Fun Fact","more","input",{type:"text",placeholder:"Optional",maxlength:"120"}),b=this._createButton("Add to Zoo","primary");b.type="submit";const f=this._createButton("Reset","ghost");f.type="reset";const C=this._createRow([b,f]);this.addAnimalForm.append(l,i,d,y,h,p,g,C,this.formMessage),r.append(this.addAnimalForm),this._attachValidation(),t.append(e,s,o,r),this.append(t)}connectedCallback(){this._wireEvents(),this._loadAnimals(),this._renderAdoptedList()}_clearNode(t){for(;t.firstChild;)t.removeChild(t.firstChild)}_createPanel(t){const e=document.createElement("section");e.className="panel";const n=document.createElement("h2");return n.textContent=t,e.appendChild(n),e}_createRow(t){const e=document.createElement("div");e.className="row";const n=Array.isArray(t)?t:[t];for(const s of n)s&&e.appendChild(s);return e}_createButton(t,e){const n=document.createElement("button");return n.textContent=t,n.className="btn"+(e?" "+e:""),n}_createLabeledInput(t,e,n){const s=document.createElement("label");s.textContent=t;const o=document.createElement("input");return o.type=e,o.name=n,s.appendChild(o),s}_createLabeledSelect(t,e,n){const s=document.createElement("label");s.textContent=t;const o=document.createElement("select");return o.name=e,n.forEach(r=>{const a=document.createElement("option");a.value=r,a.textContent=r||"Select...",o.appendChild(a)}),s.appendChild(o),s}async _loadAnimals(){try{const t=await fetch(`${L}/animals`,{cache:"no-store"});if(!t.ok)throw new Error(`Fetch failed: ${t.status}`);const e=await t.json();console.log("Fetched data:",e),this.zooAnimals=Array.isArray(e.animals)?e.animals:e,this._populateDropdown()}catch(t){console.error("Animal load error:",t),this.animalCardContainer.textContent="Could not load animals."}}_populateDropdown(){this._clearNode(this.selectedAnimalDropdown);const t=document.createElement("option");t.value="",t.textContent="- Select an Animal -",this.selectedAnimalDropdown.appendChild(t),this.zooAnimals.forEach(e=>{const n=document.createElement("option");n.value=e.name,n.textContent=e.name,this.selectedAnimalDropdown.appendChild(n)})}_field(t,e,n="input",s={}){const o=document.createElement("div");o.className="field";const r=document.createElement("label");r.setAttribute("for",e),r.textContent=t;const a=document.createElement(n);a.name=e,a.id=e,Object.entries(s).forEach(([i,d])=>a.setAttribute(i,d));const l=document.createElement("div");return l.className="field-error",l.id=`${e}-error`,l.setAttribute("aria-live","polite"),a.setAttribute("aria-describedby",l.id),o.append(r,a,l),o}_getField(t){const e=this.addAnimalForm.querySelector(`[name="${t}"]`),n=e?.closest(".field"),s=n?.querySelector(".field-error");return{wrap:n,control:e,error:s}}_setError(t,e){const{wrap:n,control:s,error:o}=this._getField(t);n&&(e?(n.classList.add("is-invalid"),s?.setAttribute("aria-invalid","true"),o&&(o.textContent=e)):(n.classList.remove("is-invalid"),s?.removeAttribute("aria-invalid"),o&&(o.textContent="")))}_validateField(t){const{control:e}=this._getField(t);if(!e)return!0;const n=e.tagName.toLowerCase(),s=e.getAttribute("type")||"";(n==="input"&&(s==="text"||s==="url")||n==="textarea")&&(e.value=e.value.trim());const o=e.validity,r={species:"Species",class:"Class",conservationStatus:"Conservation Status",habitat:"Habitat",img:"Image URL",description:"Description",more:"Fun Fact"};let a="";if(o.valueMissing?a=`${r[e.name]||"This field"} is required.`:o.tooShort?a=`Please enter at least ${e.getAttribute("minlength")} characters.`:o.tooLong?a=`Please use at most ${e.getAttribute("maxlength")} characters.`:o.typeMismatch&&e.type==="url"?a="Please enter a valid URL (https://…).":o.patternMismatch&&(["species","class","habitat"].includes(e.name)?a=`${r[e.name]} must contain letters only (you may use spaces or hyphens) and at least 2 letters.`:a="Please match the requested format."),!a&&e.name==="conservationStatus"&&e.value===""&&(a="Please select a conservation status."),!a&&e.name==="img"&&e.value){const l=e.value.trim();if(!/^https:\/\//i.test(l))a="Image URL must start with https://";else{let i=l;try{i=new URL(l).pathname}catch{}/\.(png|jpe?g|gif)$/i.test(i)||(a="Please use a URL ending in .png, .jpg, .jpeg, or .gif")}}return this._setError(e.name,a),!a}_validateForm(){const t=["species","class","conservationStatus","habitat","img","description","more"];let e=null,n=!0;for(const s of t){const o=this._validateField(s);!o&&!e&&(e=this._getField(s).control),n=n&&o}return!n&&e&&e.focus(),n}_attachValidation(){this.addAnimalForm.querySelectorAll("input, select, textarea").forEach(e=>{e.addEventListener("blur",()=>this._validateField(e.name)),e.addEventListener("input",()=>{e.checkValidity()&&this._setError(e.name,"")}),e.tagName.toLowerCase()==="select"&&e.addEventListener("change",()=>this._validateField(e.name))})}_wireEvents(){this.selectedAnimalDropdown.addEventListener("change",async()=>{const t=this.zooAnimals.find(e=>e.name===this.selectedAnimalDropdown.value);t&&this._renderCard(t)}),this.searchQueryInput.addEventListener("input",async()=>{const t=(this.searchQueryInput.value||"").trim().toLowerCase();if(this._clearNode(this.searchResultsList),!t)return;const e=s=>String(s??"").toLowerCase(),n=this.zooAnimals.filter(s=>[s.name,s.type,s.class,s.species,s.habitat,s.conservationStatus].some(r=>e(r).includes(t)));if(n.length===0){const s=document.createElement("li");s.textContent="No matches",s.className="muted",this.searchResultsList.appendChild(s);return}for(const s of n){const o=document.createElement("li"),r=s?.name??"Unknown",a=s?.type??s?.class??s?.species??"";o.textContent=a?`${r} (${a})`:r,o.addEventListener("click",()=>this._renderCard(s)),this.searchResultsList.appendChild(o)}}),this.addAnimalForm.addEventListener("submit",async t=>{if(t.preventDefault(),t.stopPropagation(),!this._validateForm())return;const e=new FormData(this.addAnimalForm),n={name:e.get("species")?.trim(),type:e.get("class")?.trim(),conservationStatus:e.get("conservationStatus")?.trim(),habitat:e.get("habitat")?.trim(),description:e.get("description")?.trim()},s=e.get("img")?.trim();s?n.image=s:n.image="images/comingSoon.png";const o=e.get("more")?.trim();o&&(n.funFact=o);const r=["name","type","conservationStatus","habitat","description"];for(const a of r)if(!n[a]||n[a].trim()===""){this.formMessage.textContent=`Error: ${a} is required.`;return}try{console.log("Sending animal data:",n);const a=await fetch(`${L}/animals`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!a.ok){const i=await a.text();throw console.error("Server error response:",i),new Error(`Create failed: ${a.status} - ${i}`)}let l=null;a.status===204?(await this._loadAnimals(),l=this.zooAnimals.find(i=>i.name===n.name&&i.type===n.type)||n):(l=await a.json(),this.zooAnimals.push(l),this._populateDropdown()),a.status!==204&&this._populateDropdown(),this.formMessage.textContent="Animal added!",this.addAnimalForm.reset(),["species","class","conservationStatus","habitat","img","description","more"].forEach(i=>this._setError(i,"")),setTimeout(()=>this.formMessage.textContent="",4e3)}catch(a){console.error(a),this.formMessage.textContent="Error: could not save animal."}})}_renderCard(t){this._clearNode(this.animalCardContainer);const e=document.createElement("div");e.className="animal-card";const n=document.createElement("img");n.src=t.image,n.alt=t.name;const s=S(t.name);k(t.name);const o=P(t.name),r=document.createElement("h3");if(r.textContent=s,o){const f=document.createElement("span");f.textContent="✓ Adopted",f.style.cssText="display: inline-block; margin-left: 8px; padding: 4px 8px; background: #28a745; color: white; border-radius: 4px; font-size: 0.75rem; font-weight: 600;",r.appendChild(f)}const a=document.createElement("p");a.textContent=`Class: ${t.type}`;const l=document.createElement("p");l.textContent=`Status: ${t.conservationStatus}`;const i=document.createElement("p");i.textContent=`Habitat: ${t.habitat}`;const d=document.createElement("p");d.textContent=t.description||"";const u=document.createElement("div");u.style.cssText="margin-top: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #5aa2ff; display: none;";const y=document.createElement("strong");y.textContent="Fun Fact: ",y.style.cssText="color: #1a4d7a; display: block; margin-bottom: 4px;";const h=document.createElement("p");h.textContent=t.funFact||"",h.style.cssText="color: #495057; margin: 0; font-style: italic;",u.append(y,h);let p=null;if(t.funFact){p=this._createButton("Show Fun Fact","ghost"),p.style.cssText+="margin-right: 8px;";let f=!1;p.addEventListener("click",()=>{f=!f,u.style.display=f?"block":"none",p.textContent=f?"Hide Fun Fact":"Show Fun Fact"})}const g=this._createButton(o?"Already Adopted":"Adopt",o?"ghost":"primary");o?(g.disabled=!0,g.style.opacity="0.6",g.style.cursor="not-allowed"):g.addEventListener("click",()=>{R(t.name,(f,C,m)=>{this._renderCard(t),this._renderAdoptedList()})});const b=document.createElement("div");b.style.cssText="display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap;",p&&b.appendChild(p),b.appendChild(g),e.append(n,r,a,l,i,d,u,b),this.animalCardContainer.appendChild(e)}_renderAdoptedList(){if(this._clearNode(this.adoptedAnimalsList),!v||v.size===0){const t=document.createElement("li");t.className="muted",t.textContent="No adopted animals yet.",this.adoptedAnimalsList.appendChild(t);return}for(const t of v){const e=document.createElement("li"),n=document.createElement("div");n.className="adopt-info";const s=document.createElement("span");s.textContent=t;const o=$(t),r=document.createElement("span");r.className="adopt-phone",r.textContent=o?`Phone: ${o}`:"",n.append(s),o&&n.append(r);const a=document.createElement("button");a.type="button",a.className="btn danger sm",a.textContent="Remove",a.setAttribute("aria-label",`Remove adoption for ${t}`),a.addEventListener("click",()=>{let l=null;for(const[i,d]of x.entries())if(d===t){l=i,x.delete(i);break}if(!l)for(const i of this.zooAnimals){const d=i.name.charAt(0).toUpperCase()+i.name.slice(1).toLowerCase();if(t===d){l=i.name;break}}if(v.delete(t),_.delete(t),this._renderAdoptedList(),l&&this.selectedAnimalDropdown.value===l){const i=this.zooAnimals.find(d=>d.name===l);i&&this._renderCard(i)}}),e.append(n,a),this.adoptedAnimalsList.appendChild(e)}}}customElements.define("animal-exhibit",B);
